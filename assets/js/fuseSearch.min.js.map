{"version":3,"sources":["../../src/js/fuseSearch.js"],"names":[],"mappings":"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","file":"fuseSearch.min.js","sourcesContent":["// @ts-check\r\n\r\nself.onmessage = (e) => {\r\n  switch (e.data.type) {\r\n    case \"init\":\r\n      importScripts(\"../lib/fuse/fuse.min.js\");\r\n      self.workerSearchThrothlePeriod = e.data.data.workerSearchThrothlePeriod;\r\n      self.maxResultLength = e.data.data.maxResultLength;\r\n      self.highlightTag = e.data.data.highlightTag;\r\n      self._index = new Fuse(e.data.data.data, e.data.data.options);\r\n      break;\r\n\r\n    case \"search\":\r\n      searchWithTimeout(e.data.data.query);\r\n      break;\r\n  }\r\n};\r\n\r\nlet timeout = undefined;\r\n\r\nconst searchWithTimeout = (query) => {\r\n  clearTimeout(timeout);\r\n  timeout = setTimeout(() => {\r\n    postMessage(search(query));\r\n  }, workerSearchThrothlePeriod);\r\n};\r\n\r\nconst search = (query) => {\r\n  const results = [];\r\n  const rows = self._index.search(query);\r\n\r\n  if (rows.length > 0 && !!rows[0].matches) {\r\n    rows.forEach((x) => {\r\n      x.matches.sort((a, b) => a.indices[0][2] - b.indices[0][2]);\r\n    });\r\n\r\n    rows.sort((a, b) => {\r\n      const res = a.matches[0].indices[0][2] - b.matches[0].indices[0][2];\r\n      if (res === 0) {\r\n        return a.score - b.score;\r\n      }\r\n\r\n      return res;\r\n    });\r\n  }\r\n\r\n  for (let i = 0; i < Math.min(rows.length, maxResultLength); i++) {\r\n    let { item, matches } = rows[i];\r\n    let title = item.title;\r\n    let content = item.content;\r\n    let minIndex = content.length;\r\n    matches.forEach(({ indices, key }) => {\r\n      if (key === \"content\") {\r\n        let offset = 0;\r\n        if (indices[0][0] < minIndex) {\r\n          minIndex = indices[0][0];\r\n        }\r\n        let lastLast = 0;\r\n        for (let i = 0; i < indices.length; i++) {\r\n          if (indices[i][0] < lastLast) {\r\n            if (indices[i][1] > lastLast) {\r\n              lastLast = indices[i][1];\r\n            }\r\n            continue;\r\n          }\r\n          lastLast = indices[i][1];\r\n\r\n          let substr = content.substring(\r\n            indices[i][0] + offset,\r\n            indices[i][1] + 1 + offset\r\n          );\r\n          let tag = `<${highlightTag}>` + substr + `</${highlightTag}>`;\r\n          content =\r\n            content.substring(0, indices[i][0] + offset) +\r\n            tag +\r\n            content.substring(indices[i][1] + 1 + offset, content.length);\r\n          offset += highlightTag.length * 2 + 5;\r\n        }\r\n      } else if (key === \"title\") {\r\n        let offset = 0;\r\n        for (let i = 0; i < indices.length; i++) {\r\n          let substr = title.substring(\r\n            indices[i][0] + offset,\r\n            indices[i][1] + 1 + offset\r\n          );\r\n          let tag = `<${highlightTag}>` + substr + `</${highlightTag}>`;\r\n          title =\r\n            title.substring(0, indices[i][0] + offset) +\r\n            tag +\r\n            title.substring(indices[i][1] + 1 + offset, content.length);\r\n          offset += highlightTag.length * 2 + 5;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (minIndex > 19) {\r\n      content = \"...\" + content.substr(minIndex - 15);\r\n    }\r\n\r\n    results.push({\r\n      uri: item.uri,\r\n      title: title,\r\n      date: item.date,\r\n      context: content,\r\n    });\r\n  }\r\n  return results;\r\n};\r\n"]}